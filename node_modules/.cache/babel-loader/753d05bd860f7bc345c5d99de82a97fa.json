{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import _objectSpread from\"/Users/kabash/Documents/shop-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{jsx as _jsx}from\"react/jsx-runtime\";import _regeneratorRuntime from\"/Users/kabash/Documents/shop-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/kabash/Documents/shop-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/kabash/Documents/shop-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{Fragment,useEffect}from'react';import{Route,Switch,useHistory}from'react-router-dom';import jwt_decode from\"jwt-decode\";import{setBearerToken,shopApiInstance}from'../network';import{toast,ToastContainer}from'react-toastify';import'react-toastify/dist/ReactToastify.css';import Login from'./Login';import Register from'./Register';import Catalogue from'./Catalogue';import NavBar from'./NavBar';import Orders from'./Orders';import Home from'./Home';import CreateProduct from'./CreateProduct';import PasswordUpdate from'./PasswordUpdate';import{usePersistedState}from'../utils';import{toastConfig}from'./styledElements';function App(){var _usePersistedState=usePersistedState('products',[]),_usePersistedState2=_slicedToArray(_usePersistedState,2),products=_usePersistedState2[0],setProducts=_usePersistedState2[1];//const [ token, setToken ] = usePersistedState('token', '');\nvar _usePersistedState3=usePersistedState('user',{}),_usePersistedState4=_slicedToArray(_usePersistedState3,2),user=_usePersistedState4[0],setUser=_usePersistedState4[1];var _usePersistedState5=usePersistedState('authenticated',false),_usePersistedState6=_slicedToArray(_usePersistedState5,2),authenticated=_usePersistedState6[0],setAuthenticated=_usePersistedState6[1];var _usePersistedState7=usePersistedState('orders',[]),_usePersistedState8=_slicedToArray(_usePersistedState7,2),orders=_usePersistedState8[0],setOrders=_usePersistedState8[1];var _usePersistedState9=usePersistedState('mobile',false),_usePersistedState10=_slicedToArray(_usePersistedState9,2),mobile=_usePersistedState10[0],setMobile=_usePersistedState10[1];var history=useHistory();useEffect(function(){window.addEventListener('load',function(){setBearerToken(localStorage.getItem('token')||'');});window.addEventListener('resize',function(){return window.innerWidth<768?setMobile(true):setMobile(false);});//window.addEventListener('unload', () => logout());\n});useEffect(function(){window.innerWidth<768?setMobile(true):setMobile(false);},[setMobile]);var getAdminOrders=function getAdminOrders(){shopApiInstance.get('/orders/admin').then(function(response){response.data.orders?setOrders(response.data.orders.reverse()):setOrders([]);}).catch(function(err){return console.log(err);});};var getOrders=function getOrders(){shopApiInstance.get('/orders').then(function(response){response.data.orders?setOrders(response.data.orders.reverse()):setOrders([]);}).catch(function(err){return console.log(err);});};var getProducts=function getProducts(){shopApiInstance.get('/products').then(function(response){setProducts(response.data.products.reverse());}).catch(function(err){return console.log(err);});};var getUser=function getUser(token){var user=jwt_decode(token);var username=user.username,email=user.email,role=user.role,password=user.password,userId=user.userId;setUser({username:username,email:email,role:role,password:password,userId:userId});};var handleLogin=function handleLogin(e,params){e.preventDefault();//console.log(window.env.EXPOSED_API_URL)\nshopApiInstance.post('/users/signin',params).then(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(response){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.target.reset();//await setToken(response.data.token);\n_context.next=3;return localStorage.setItem('token',response.data.token);case 3:_context.next=5;return setBearerToken(response.data.token);case 5:_context.next=7;return setAuthenticated(true);case 7:_context.next=9;return getUser(response.data.token);case 9:getProducts();user.role==='administrator'?getAdminOrders():getOrders();toast.success(\"Successfully logged in!\",toastConfig);history.push('/home');case 13:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}()).catch(function(err){console.log(err);var error=function error(){if(err.message.includes('401'))return'Email/Password combination incorrect. Try again.';if(err.message.includes('404'))return'User not found.';};toast.error(error,toastConfig);});};var handleRegister=function handleRegister(e,params){e.preventDefault();shopApiInstance.post('/users/signup',params).then(function(response){console.log(response.data);toast.success('Account successfully created. Login here.',toastConfig);history.push('/');}).catch(function(err){toast.error(err.message,toastConfig);});console.log(e.target,params);};var addProduct=function addProduct(e,params){shopApiInstance.post('/products',params).then(function(response){console.log(response.data);toast.success('Product successfully created',toastConfig);getProducts();history.push('/products');}).catch(function(err){toast.error(err.message,toastConfig);});e.target.reset();};var updateProduct=function updateProduct(e,id,params){shopApiInstance.put(\"/products/\".concat(id),params).then(function(response){console.log(response.data);toast.success('Product successfully updated',toastConfig);getProducts();history.push('/products');}).catch(function(err){toast.error(err.message,toastConfig);});e.target.reset();};var deleteProduct=function deleteProduct(id){var deleteParams={productId:id};shopApiInstance.delete('/orders/delete',{data:deleteParams}).then(function(result){return console.log(result);});shopApiInstance.delete(\"/products/\".concat(id)).then(function(response){console.log(response.data);toast.success('Products successfully deleted',toastConfig);getProducts();history.push('/products');}).catch(function(err){toast.error(err.message,toastConfig);});};var updatePassword=function updatePassword(e,params){shopApiInstance.put(\"/users/\".concat(user.userId),params).then(function(response){console.log(response.data);toast.success('Password updated successfully!',toastConfig);history.push('/home');}).catch(function(err){var error=err.message.includes('401')?'Incorrect password. Try again.':err.message;toast.error(error,toastConfig);});e.target.reset();};var updateProductAvailability=function updateProductAvailability(path){console.log(path);shopApiInstance.put(path).then(function(response){console.log(response.data);getProducts();toast.success('Order updated successfully',toastConfig);}).catch(function(err){console.log(err);toast.error(err.message,toastConfig);});};var logout=function logout(){//setToken('');\nsetBearerToken('');setAuthenticated(false);setProducts([]);localStorage.clear();toast.dark('Logged out.',toastConfig);history.push('/');};return/*#__PURE__*/_jsxs(Fragment,{children:[/*#__PURE__*/_jsx(ToastContainer,{}),authenticated&&/*#__PURE__*/_jsx(NavBar,{logout:logout,getOrders:getOrders,getAdminOrders:getAdminOrders,user:user,mobile:mobile}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(Route,{exact:true,path:\"/\",render:function render(props){return/*#__PURE__*/_jsx(Login,_objectSpread(_objectSpread({},props),{},{handleLogin:handleLogin}));}}),/*#__PURE__*/_jsx(Route,{path:\"/home\",component:Home}),/*#__PURE__*/_jsx(Route,{path:\"/register\",render:function render(props){return/*#__PURE__*/_jsx(Register,_objectSpread(_objectSpread({},props),{},{handleRegister:handleRegister}));}}),/*#__PURE__*/_jsx(Route,{path:\"/products\",render:function render(props){return/*#__PURE__*/_jsx(Catalogue,_objectSpread(_objectSpread({},props),{},{products:products,user:user,deleteProduct:deleteProduct,updateProductAvailability:updateProductAvailability,updateProduct:updateProduct,mobile:mobile}));}}),/*#__PURE__*/_jsx(Route,{path:\"/orders\",render:function render(props){return/*#__PURE__*/_jsx(Orders,_objectSpread(_objectSpread({},props),{},{orders:orders,mobile:mobile}));}}),/*#__PURE__*/_jsx(Route,{path:\"/create-product\",render:function render(props){return/*#__PURE__*/_jsx(CreateProduct,_objectSpread(_objectSpread({},props),{},{addProduct:addProduct}));}}),/*#__PURE__*/_jsx(Route,{path:\"/password\",render:function render(props){return/*#__PURE__*/_jsx(PasswordUpdate,_objectSpread(_objectSpread({},props),{},{user:user,updatePassword:updatePassword}));}})]})]});};export default App;","map":{"version":3,"sources":["/Users/kabash/Documents/shop-frontend/src/components/App.js"],"names":["React","Fragment","useEffect","Route","Switch","useHistory","jwt_decode","setBearerToken","shopApiInstance","toast","ToastContainer","Login","Register","Catalogue","NavBar","Orders","Home","CreateProduct","PasswordUpdate","usePersistedState","toastConfig","App","products","setProducts","user","setUser","authenticated","setAuthenticated","orders","setOrders","mobile","setMobile","history","window","addEventListener","localStorage","getItem","innerWidth","getAdminOrders","get","then","response","data","reverse","catch","err","console","log","getOrders","getProducts","getUser","token","username","email","role","password","userId","handleLogin","e","params","preventDefault","post","target","reset","setItem","success","push","error","message","includes","handleRegister","addProduct","updateProduct","id","put","deleteProduct","deleteParams","productId","delete","result","updatePassword","updateProductAvailability","path","logout","clear","dark","props"],"mappings":"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","sourcesContent":["import React, { Fragment, useEffect } from 'react';\nimport { Route, Switch, useHistory } from 'react-router-dom';\nimport jwt_decode from \"jwt-decode\";\nimport {setBearerToken, shopApiInstance} from '../network';\nimport { toast, ToastContainer } from 'react-toastify';\nimport 'react-toastify/dist/ReactToastify.css';\nimport Login from './Login';\nimport Register from './Register';\nimport Catalogue from './Catalogue';\nimport NavBar from './NavBar';\nimport Orders from './Orders';\nimport Home from './Home';\nimport CreateProduct from './CreateProduct';\nimport PasswordUpdate from './PasswordUpdate';\nimport { usePersistedState } from '../utils';\nimport { toastConfig } from './styledElements'; \n\n\nfunction App() {\n\n    const [ products, setProducts ] = usePersistedState('products', []);\n    //const [ token, setToken ] = usePersistedState('token', '');\n    const [user, setUser] = usePersistedState('user', {});\n    const [authenticated, setAuthenticated] = usePersistedState('authenticated', false);\n    const [ orders, setOrders ] = usePersistedState('orders', []);\n    const [ mobile, setMobile ] = usePersistedState('mobile', false);\n    \n    let history = useHistory();\n\n    useEffect(() => {\n        window.addEventListener('load', () => {\n            setBearerToken((localStorage.getItem('token')) || '');\n        })\n        window.addEventListener('resize', () => window.innerWidth < 768 ? setMobile(true) : setMobile(false));\n        //window.addEventListener('unload', () => logout());\n    });\n\n    useEffect(() => {\n        window.innerWidth < 768 ? setMobile(true) : setMobile(false);\n    }, [setMobile]);\n\n    const getAdminOrders = () => {\n        shopApiInstance.get('/orders/admin')\n        .then(response => {\n            response.data.orders ? setOrders(response.data.orders.reverse()) : setOrders([]);\n        }).catch(err => console.log(err));\n    }\n\n    const getOrders = () => {\n        shopApiInstance.get('/orders')\n        .then(response => {\n            response.data.orders ? setOrders(response.data.orders.reverse()) : setOrders([]);\n        }).catch(err => console.log(err));\n    }\n\n    const getProducts = () => {\n        shopApiInstance.get('/products')\n        .then(response => {\n            setProducts(response.data.products.reverse());\n        }).catch(err => console.log(err));\n    }\n\n    const getUser = token => {\n        const user = jwt_decode(token);\n        const { username, email, role, password, userId } = user;\n        setUser({username, email, role, password, userId});\n    }\n\n    const handleLogin = (e, params) => {\n        e.preventDefault();\n        //console.log(window.env.EXPOSED_API_URL)\n        shopApiInstance.post('/users/signin', params)\n        .then(async response => {\n            e.target.reset();\n            //await setToken(response.data.token);\n            await localStorage.setItem('token', response.data.token)\n            await setBearerToken(response.data.token);\n            await setAuthenticated(true);\n            await getUser(response.data.token);\n            getProducts();\n            user.role === 'administrator' ? getAdminOrders() : getOrders();\n            toast.success(\"Successfully logged in!\", toastConfig);\n            history.push('/home');\n        })\n        .catch(err => {\n            console.log(err);\n            const error = () => {\n                if(err.message.includes('401')) return 'Email/Password combination incorrect. Try again.';\n                if(err.message.includes('404')) return 'User not found.'\n            }\n            toast.error(error, toastConfig);\n        });\n    }\n\n    const handleRegister = (e, params) => {\n        e.preventDefault();\n        shopApiInstance.post('/users/signup', params)\n        .then(response => {\n            console.log(response.data);\n            toast.success('Account successfully created. Login here.', toastConfig);\n            history.push('/');\n        }).catch(err => {\n            toast.error(err.message, toastConfig);\n        })\n        console.log(e.target, params);\n    }\n\n    const addProduct = (e, params) => {\n        shopApiInstance.post('/products', params)\n        .then( response => {\n            console.log(response.data);\n            toast.success('Product successfully created', toastConfig);\n            getProducts();\n            history.push('/products');\n        }).catch(err => {\n            toast.error(err.message, toastConfig);\n        })\n        e.target.reset();\n    }\n\n    const updateProduct = (e, id, params) => {\n        shopApiInstance.put(`/products/${id}`, params)\n        .then(response => {\n            console.log(response.data);\n            toast.success('Product successfully updated', toastConfig);\n            getProducts();\n            history.push('/products');\n        }).catch(err => {\n            toast.error(err.message, toastConfig);\n        })\n        e.target.reset();\n    }\n\n    const deleteProduct = id => {\n        const deleteParams = { productId: id};\n        shopApiInstance.delete('/orders/delete', {data: deleteParams})\n            .then(result => console.log(result));\n        shopApiInstance.delete(`/products/${id}`)\n        .then(response => {\n            console.log(response.data);\n            toast.success('Products successfully deleted', toastConfig);\n            getProducts();\n            history.push('/products');\n        }).catch(err => {\n            toast.error(err.message, toastConfig);\n        })\n    }\n\n    const updatePassword = (e, params) => {\n        shopApiInstance.put(`/users/${user.userId}`, params)\n        .then(response => {\n            console.log(response.data);\n            toast.success('Password updated successfully!', toastConfig);\n            history.push('/home');\n        }).catch(err => {\n            const error = err.message.includes('401') ? 'Incorrect password. Try again.' : err.message; \n            toast.error(error, toastConfig);\n        })\n        e.target.reset();\n    }\n\n    const updateProductAvailability = path => {\n        console.log(path);\n        shopApiInstance.put(path)\n        .then(response => {\n            console.log(response.data);\n            getProducts();\n            toast.success('Order updated successfully', toastConfig);\n        }).catch(err => {\n            console.log(err);\n            toast.error(err.message, toastConfig);\n        })\n    }\n\n\n    const logout = () => {\n        //setToken('');\n        setBearerToken('');\n        setAuthenticated(false);\n        setProducts([]);\n        localStorage.clear();\n        toast.dark('Logged out.', toastConfig);\n        history.push('/');\n    }\n    \n    return (\n        <Fragment>\n            <ToastContainer />\n            {authenticated && <NavBar \n            logout={logout} \n            getOrders={getOrders}\n            getAdminOrders={getAdminOrders} \n            user={user}\n            mobile={mobile}\n            />}\n            <Switch>\n                <Route exact path='/' render={(props) => (\n                    <Login { ...props} handleLogin={handleLogin} />\n                )}\n                />\n                <Route path='/home' component={Home}/>\n                <Route path='/register' render={(props) => (\n                    <Register { ...props} handleRegister={handleRegister} />\n                )}\n                />\n                <Route path='/products' render={(props) => (\n                    <Catalogue { ...props} \n                    products={products} \n                    user={user} \n                    deleteProduct={deleteProduct} \n                    updateProductAvailability={updateProductAvailability}\n                    updateProduct={updateProduct}\n                    mobile={mobile}\n                    />\n                )}\n                />\n                <Route path='/orders' render={(props) => (\n                    <Orders { ...props} orders={orders} mobile={mobile}/>\n                )}\n                />\n                <Route path='/create-product' render={(props) => (\n                    <CreateProduct { ...props} addProduct={addProduct} />\n                )}/>\n                <Route path='/password' render={(props) => (\n                    <PasswordUpdate { ...props} user={user} updatePassword={updatePassword} />\n                )}/>\n            </Switch>\n        </Fragment>\n        \n        \n    )\n};\n\nexport default App;"]},"metadata":{},"sourceType":"module"}